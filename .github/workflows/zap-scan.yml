name: OWASP ZAP Active Scan

on:
  # Trigger manually via the "Actions" tab
  workflow_dispatch:
  # Or trigger on every push to main
  push:
    branches: [ "main" ]

jobs:
  zap_scan:
    name: Run ZAP Scan
    runs-on: ubuntu-latest
    steps:
      # Step 1: Checkout your code (so ZAP can see your yaml file)
      - name: Checkout Code
        uses: actions/checkout@v4

      # Step 2: Run the scan using your existing plan
      - name: ZAP Automation Scan
        uses: zaproxy/action-af@v0.5.0
        with:
          # Point to your YAML file in the repo
          plan: 'active-scan-no-auth.yaml'
          # Use the Weekly image to match your local success
          docker_name: 'ghcr.io/zaproxy/zaproxy:weekly'

      # Step 3: Upload the report as an artifact
      - name: Upload HTML Report
        uses: actions/upload-artifact@v4
        if: always() # Run this even if the scan finds vulnerabilities and "fails"
        with:
          name: ZAP-Report
          # The path matches 'reportFile' in your YAML
          # (ZAP maps /zap/wrk to the Github Workspace root)
          path: juice-shop-active.html